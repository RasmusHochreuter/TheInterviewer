# Feature: Simple Calculator
> Specification generated by /interview on 2026-02-13
> This is a planning document. No implementation code has been written.

## Implementation Instructions
This specification is context for the implementing agent. Read and internalize it fully before writing any code.

**IMPORTANT — Do NOT:**
- Add comments referencing this spec (no `// See spec: ...`, no `// REQ-001`, no `// Don't #3`)
- Structure code around spec sections — structure it around clean domain logic
- Embed spec traceability IDs in code, comments, variable names, or test names
- Add comments explaining "why" when the code is self-documenting

**DO:**
- Write clean, idiomatic TypeScript/React that follows modern conventions
- Let the constraints from this spec guide your decisions silently — they should be invisible in the final code
- Name things after domain concepts, not spec concepts
- Write tests that verify behavior, named after what they verify (not after spec requirement IDs)

## Overview
A simple, browser-based arithmetic calculator built with React and TypeScript. It supports the four basic operations (+, -, *, /), decimal numbers, chained operations, and a clean minimal/modern UI. Input is button-only (no keyboard support). The display shows a single line with the current number or result.

## Scope
### In Scope
- Four basic arithmetic operations: addition, subtraction, multiplication, division
- Decimal number support
- Chained operations (pressing operator after = continues from result)
- Single-line display showing current number or result
- Button-only input (digits 0-9, operators, decimal point, equals, clear, backspace)
- Error state for division by zero (requires Clear to reset)
- 15-digit input cap
- Minimal/modern visual design

### Out of Scope
- Keyboard input
- Scientific functions (sin, cos, log, exponents, parentheses)
- Memory functions (M+, M-, MR, MC)
- Calculation history
- State persistence across page reloads (no localStorage)
- Theming or dark mode toggle

### Deferred
- Keyboard shortcut support
- History panel
- Copy result to clipboard

## Codebase Context
- **Language**: TypeScript
- **Framework**: React (create with Vite or similar)
- **Styling**: CSS (or CSS modules) — minimal/modern aesthetic
- **Testing**: Vitest + React Testing Library
- **Project structure**: Single project with folders for components, logic/hooks, and styles
- **State management**: React useState (no external state library needed)

## Requirements
- Display shows "0" on initial load
- Pressing digit buttons (0-9) builds the current number on the display
- Pressing an operator (+, -, *, /) stores the current number and operator, then resets display for next input
- Pressing = evaluates the pending operation and displays the result
- Pressing Clear (C) resets all state to initial ("0", no pending operation)
- Pressing Backspace removes the last character from the current input; if only one digit remains, resets to "0"
- Pressing = after a result with no new operator does nothing
- Pressing an operator after = chains from the displayed result
- Decimal point (.) appends to current number; ignored if already present
- Division by zero displays "Error"
- In Error state, only the Clear button is functional
- Input is capped at 15 digits (decimal point does not count toward digit cap)

## Prohibitions (Don'ts)
- **NEVER evaluate arbitrary JavaScript expressions** — only support the four basic operations via the internal calculator engine
- **NEVER allow more than one decimal point per number** — pressing `.` when the current number already contains one must be ignored
- **NEVER allow leading zeros** — entering `007` must display `7` (exception: `0.` is valid)
- **NEVER allow an operator immediately after another operator without a number** — pressing `+` then `*` must replace `+` with `*`
- **NEVER persist state across page reloads** — no localStorage, sessionStorage, cookies, or URL state
- **NEVER allow interaction while in Error state** — only the Clear (C) button responds; all other buttons are ignored
- **NEVER accept keyboard input** — all interaction is through on-screen buttons only

## Decision Tree
```
User presses a button
├── Is calculator in Error state?
│   ├── Yes → Is it the Clear (C) button?
│   │   ├── Yes → Reset all state, display "0"
│   │   └── No → Ignore button press entirely
│   └── No → Continue to next check...
│
├── Is it a digit (0-9)?
│   ├── Current display is "0" OR last action was "=" → Start new number with this digit
│   ├── Current number already has 15 digits → Ignore
│   └── Otherwise → Append digit to current display number
│
├── Is it the decimal point (.)?
│   ├── Current number already contains "." → Ignore
│   ├── Last action was "=" → Start new number as "0."
│   └── Otherwise → Append "." to current number
│
├── Is it an operator (+, -, *, /)?
│   ├── Previous input was also an operator → Replace stored operator with new one
│   ├── There is a pending operation and a new number entered → Evaluate pending operation first, store result, set new operator
│   └── Otherwise → Store current displayed number as left operand, set operator, await right operand
│
├── Is it equals (=)?
│   ├── No pending operation → Do nothing
│   ├── Pending operation is ÷ and right operand is 0 → Display "Error"
│   └── Otherwise → Evaluate operation, display result, clear pending operation
│
├── Is it Backspace (⌫)?
│   ├── Current number has more than 1 character → Remove last character
│   └── Current number has 1 character (or is "0") → Set display to "0"
│
└── Is it Clear (C)?
    └── Reset everything: display "0", clear stored operand, clear operator
```

## Domain Rules & Exceptions
| Rule | Applies When | Exception | Who Can Override |
|------|-------------|-----------|-----------------|
| 15-digit input cap | User entering digits | Decimal point doesn't count as a digit | N/A |
| Leading zero suppression | User enters 0 followed by non-zero digit | "0." is valid for decimal entry | N/A |
| Operator replacement | User presses two operators in sequence | N/A | N/A |
| Error state lockout | Division by zero occurred | Clear (C) button always works | N/A |
| Chained operations | User presses operator after = | N/A | N/A |

## Escalation & Guardrails
- **Fail if**: Division by zero → display "Error", lock all buttons except Clear
- **Ignore if**: Input exceeds 15 digits, duplicate decimal point, button press during Error (except Clear)
- **No network calls**: This is a purely client-side application with zero external dependencies at runtime

## UI Layout
```
┌─────────────────────────┐
│                   0     │  ← Single-line display, right-aligned
├─────────────────────────┤
│  C  │  ⌫  │     │  /   │
├─────┼──────┼─────┼──────┤
│  7  │  8   │  9  │  *   │
├─────┼──────┼─────┼──────┤
│  4  │  5   │  6  │  -   │
├─────┼──────┼─────┼──────┤
│  1  │  2   │  3  │  +   │
├─────┼──────┼─────┼──────┤
│  0         │  .  │  =   │
└─────────────────────────┘
```

- **Display**: Large font, right-aligned, single-line. Truncates or shrinks text if result is long.
- **Buttons**: Flat/rounded, neutral base color, operator column in a subtle accent color, `=` button in a stronger accent.
- **Grid**: 4 columns, 5 rows of buttons. `0` spans 2 columns.
- **Overall**: Clean white/light gray background, subtle shadows, modern feel. Centered on page.

## Acceptance Criteria
### Happy Path
- [ ] Given initial load, the display shows "0"
- [ ] Given the user presses 1, 2, 3, the display shows "123"
- [ ] Given the user presses 5, +, 3, =, the display shows "8"
- [ ] Given the user presses 5, +, 3, =, +, 2, =, the display shows "10" (chaining)
- [ ] Given the user presses 1, ., 5, +, 2, ., 5, =, the display shows "4"
- [ ] Given the user presses C, the display resets to "0"
- [ ] Given the user presses 1, 2, 3, ⌫, the display shows "12"
- [ ] Given the user presses 5, ⌫, the display shows "0"

### Negative / Prohibition Tests
- [ ] Given the user presses 1, ., 2, ., 3 — the display shows "1.23" (second decimal ignored)
- [ ] Given the user presses 0, 0, 7 — the display shows "7" (leading zeros suppressed)
- [ ] Given the user presses 5, +, * — the pending operator becomes * (replacement, not stacking)
- [ ] Given the calculator is in Error state, pressing any digit or operator does nothing; only C works
- [ ] Given the user enters 15 digits, pressing another digit does nothing (capped)

### Edge Cases
- [ ] Given the user presses 1, /, 0, = — the display shows "Error"
- [ ] Given the display shows a result and the user presses = again — nothing changes
- [ ] Given the display shows a result and the user presses +, the calculator chains from that result
- [ ] Given the calculator is in Error state and user presses ⌫ — nothing happens
- [ ] Given the user presses . on a fresh display — the display shows "0."
- [ ] Given the user presses = with no pending operation — display unchanged

### Integration / Resilience
- [ ] Refreshing the page resets the calculator to initial state (no persistence)
- [ ] All interaction is via buttons; keyboard events produce no effect

## Files to Create (Implementation Plan)
- Create: `package.json` — Project config with React, TypeScript, Vite, Vitest
- Create: `tsconfig.json` — TypeScript configuration
- Create: `vite.config.ts` — Vite build configuration
- Create: `index.html` — Entry HTML file
- Create: `src/main.tsx` — React app entry point
- Create: `src/App.tsx` — Root app component, renders Calculator
- Create: `src/components/Calculator.tsx` — Main calculator component (display + button grid)
- Create: `src/components/Display.tsx` — Display component (single-line, right-aligned)
- Create: `src/components/Button.tsx` — Reusable button component with style variants
- Create: `src/hooks/useCalculator.ts` — Calculator state machine logic (all business rules)
- Create: `src/styles/Calculator.css` — Styles for calculator layout and theme
- Create: `src/__tests__/useCalculator.test.ts` — Unit tests for calculator logic hook
- Create: `src/__tests__/Calculator.test.tsx` — Integration tests for full calculator interaction

## Observability
- No logging, metrics, or monitoring required — this is a simple client-side app
- Console errors for development only (React strict mode warnings)

## Key Decisions Made
| Decision | Options Considered | Chosen | Rationale |
|----------|-------------------|--------|-----------|
| UI Framework | Blazor, WPF, MAUI, Console, React | React + TypeScript | Developer preference |
| Input method | Button-only, Button+keyboard, Text expression | Button-only | Simplest approach, classic calculator feel |
| Display style | Single-line, Expression+result | Single-line result only | Simpler UI, matches "simple calculator" brief |
| Error handling | Show+auto-recover, Show+require clear | Show "Error" + require Clear | Explicit reset prevents confusion |
| Chained operations | Support chaining, Reset after = | Support chaining | Natural calculator behavior |
| Decimal support | Yes, Integers only | Yes, decimals supported | Standard expectation for a calculator |
| Backspace | No (just Clear), Yes | Yes, with backspace button | More forgiving for input mistakes |
| Digit cap | 10, 15, Unlimited | 15 digits | Standard calculator precision, prevents overflow |
| Visual style | Minimal/modern, Classic, No preference | Minimal/modern | Clean, contemporary look |
| Architecture | Single project, Two projects | Single project | Appropriate for scope; logic separated via custom hook |

## Open Questions
None — all decisions have been made.
